# Try Hack Me - Wazuh Simulation

[Try Hack Me - Wazuh Simulation](https://tryhackme.com/r/room/wazuhct)

This lab includes agents and you as the manager.

## Task 1: Introduction

1. **When was Wazuh released?**

    Found in the introduction.

    **Answer:** 2015

2. **What is the term that Wazuh calls a device that is being monitored for suspicious activity and potential security threats?**

    This was in the reading. It’s the relationship between this and manager.

    **Answer:** Agent

3. **Lastly, what is the term for a device that is responsible for managing these devices?**

    I couldn’t really find it in the readings, so I checked the hint.

    **Answer:** Manager

## Task 2: Required - Deploy Wazuh Server

Access THM network VIA OpenVPN.

## Task 3: Wazuh Agents

1. **How many agents does this Wazuh management server manage?**

    We can find this by clicking on the Wazuh icon on the top left and then clicking on “Agents.”

    You should be able to see a list of agents attached to this manager.

    **Answer:** 2

2. **What is the status of the agents managed by this Wazuh management server?**

    On the screenshot above, look to the right to see the status.

    **Answer:** disconnected










## Task 4: Wazuh Vulnerability Assessment & Security Events

1. **How many “Security Event” alerts have been generated by the agent “AGENT-001”?**

    First, we will navigate to the agent page again. This time, we will click on the agent named “agent-001.” Then we will click on “Security events” at the top left.

    Next, we will be presented with a search bar. On the right side of it, we will edit the time. I simply changed it to “Years ago” instead.

    After changing it and updating it, it should display the security events alert.

    **Answer:** 196

## Task 5: Wazuh Policy Auditing

Wazuh is capable of auditing and monitoring an agent's configuration whilst proactively recording event logs. When the Wazuh agent is installed, an audit is performed where a metric is given using multiple frameworks and legislations such as NIST, MITRE, and GDPR.

## Task 6: Monitoring Logons with Wazuh

Wazuh's security event monitor is capable of actively recording both successful and unsuccessful authentication attempts. The rule with an id of 5710 detects attempted connections that are unsuccessful for the SSH protocol. Let's look at this animated picture below as an example.

The alert was created because someone tried to log onto the agent "ip-10-10-73-118" with the user "cmnatic" which does not exist. I have summarized this alert into the table below:

| Field                   | Value                  | Description                                                                              |
|-------------------------|------------------------|------------------------------------------------------------------------------------------|
| agent.ip                | 10.10.73.118           | This is the IP address of the agent that the alert was triggered on.                     |
| agent.name              | ip-10-10-73-118        | This is the hostname of the agent that the alert was triggered on.                       |
| rule.description        | sshd: Attempt to login using a non-existent user | This field is a brief description of what the event is alerting to.                      |
| rule.mitre.technique    | Brute-Force            | This field explains the MITRE technique that the alert pertains to.                      |
| rule.mitre.id           | T1110                  | This field is the MITRE ID of the alert.                                                 |
| rule.id                 | 5710                   | This field is the ID assigned to the alert by Wazuh's ruleset.                           |
| location                | /var/log/auth.log      | This field is the location of the file that the alert was generated from on the agent. In this example, it is the authentication log on the Linux agent. |







## Task 7: Collecting Windows Logs with Wazuh

1. **What is the name of the tool that we can use to monitor system events?**

    From the reading, Sysmon is used.

    **Answer:** Sysmon

2. **What standard application on Windows do these system events get recorded to?**

    From the reading, and the Sysmon room we did, you can find these events in Event Viewer.

    **Answer:** Event Viewer

## Task 8: Collecting Linux Logs with Wazuh

1. **What is the full file path to the rules located on a Wazuh management server?**

    This one can be found within the reading.

    **Answer:** /var/ossec/ruleset/rules

## Task 9: Auditing Commands on Linux with Wazuh

1. **What application do we use on Linux to monitor events such as command execution?**

    This can be found in the reading.

    **Answer:** Auditd

2. **What is the full path & filename for where the aforementioned application stores rules?**

    This can be found in the reading.

    **Answer:** /etc/audit/rules.d/audit.rules









## Task 10: Wazuh API

1. **What is the name of the standard Linux tool that we can use to make requests to the Wazuh management server?**

    This is found in the reading, near the beginning.

    **Answer:** curl

2. **What HTTP method would we use to retrieve information for a Wazuh management server API?**

    I already knew this, but I checked and it is also found in the reading.

    **Answer:** GET

3. **What HTTP method would we use to perform an action on a Wazuh management server API?**

    This one I did not know but it is found in the reading.

    **Answer:** PUT

4. **Use the API console to find the Wazuh server’s version.**

    First, we need to get to the API Console. This can be done by going to the top left and clicking on the Wazuh icon, clicking on tools, and then clicking on API Console.

    After that, we are presented with some queries already! To execute a line of code, we click on the line with the code you want to execute and a play button should appear.

    Clicking play will execute the command. Then we just look at the output. I clicked through all of them to find the server information.

    **Answer:** v4.2.5











## Task 11: Generating Reports with Wazuh

1. **Analyze the report. What is the name of the agent that has generated the most alerts?**

    First, we need to generate a report. We will go back to the Security Events section. Click on the Wazuh logo on the top left, then click Modules, then click Security Event. On this page, we generate the report by clicking on “Generate report” on the top right.

    Now that we generated the report, we will download the file to view it. We do this by going to the Wazuh logo again, then to Management, then finally Reporting.

    When we find the report we want, we go to the Actions column and click either download or delete.

    Since we know we only have one agent, we already know the answer of the name of the agent that generated the most alerts. We found the names back in Task 4.

    **Answer:** agent-001

## Task 12: Sample Data

The Wazuh management server comes with sample data bundled with the installation that can be loaded at your convenience. I have not enabled this by default to improve the performance of the server. However, if you wish to import much more data to showcase the extensibility of Wazuh further, follow the steps below:

1. Open the "Wazuh" tab in the heading.
2. Highlight over "Settings".
3. Select the "Sample Data" heading.
4. Press the "Add Data" button on the respective three cards to import the data.


## Conclusion

In this lab, we explored various aspects of Wazuh, including its deployment, management, and monitoring capabilities. We began by deploying the Wazuh server and configuring agents, followed by assessing security events and vulnerabilities. We examined how Wazuh handles log collection from both Windows and Linux systems and utilized its API for querying server details. Additionally, we reviewed the process for generating reports and loading sample data to further demonstrate Wazuh’s functionality.

Overall, the lab provided a comprehensive overview of Wazuh’s capabilities in managing security and compliance, highlighting its effectiveness in monitoring, auditing, and reporting within a networked environment.

